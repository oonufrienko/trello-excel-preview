<!DOCTYPE html>
<html>
<head>
    <title>Excel Preview Connector</title>
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
    <script>
        TrelloPowerUp.initialize({
            'attachment-sections': function(t, options) {
                return options.entries
                    .filter(att => att.name.match(/\.(xlsx?|xls)$/i))
                    .map(attachment => ({
                        id: 'excel-preview-' + attachment.id,
                        claimed: [attachment],
                        title: 'Excel Preview: ' + attachment.name,
                        icon: 'https://oonufrienko.github.io/trello-excel-preview/icon-gray.png',
                        content: {
                            type: 'iframe',
                            // КЛЮЧ: відносний шлях + передача ID
                            url: t.signUrl('./preview.html', { attachmentId: attachment.id }),
                            height: 400
                        }
                    }));
            }
        });
    </script>
</body>
</html>
